<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,viewport-fit=cover,initial-scale=1"/>
  <title>Segni di Vitta — Roleta Premiada</title>
  <style>
    :root{--bg:#080808;--white:#e9e9e9;--red:#c71b1b}
    body{margin:0;background:var(--bg);color:var(--white);font-family:Inter,system-ui,Arial;display:flex;align-items:center;justify-content:center;height:100vh}
    .card{width:360px;padding:20px;text-align:center}
    h1{font-size:22px;margin:4px 0 14px}
    .wheel{width:320px;height:320px;border-radius:50%;position:relative;margin:0 auto;overflow:visible;box-shadow:0 8px 30px rgba(0,0,0,.7)}
    .wheel-inner{width:100%;height:100%;border-radius:50%;background:linear-gradient(180deg,#0b0b0b,#111);display:flex;align-items:center;justify-content:center;transform:rotate(0deg);transition:transform 4s cubic-bezier(.2,.9,.2,1)}
    .center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:60px;height:60px;border-radius:50%;background:#111;border:4px solid #222;display:flex;align-items:center;justify-content:center}
    .pointer{position:absolute;left:50%;top:-12px;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:18px solid var(--red)}
    button{margin-top:16px;padding:12px 18px;border-radius:8px;border:0;background:var(--red);color:#fff;font-weight:700;cursor:pointer}
    small{display:block;margin-top:10px;color:#aaa;font-size:12px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Segni di Vitta — Tatuagem Premiada</h1>
    <div style="position:relative">
      <div class="pointer"></div>
      <div class="wheel" id="wheel">
        <div class="wheel-inner" id="wheelInner">
          <!-- pseudoslices — we'll draw sectors via canvas for better visual,
               but to keep simples we'll overlay an SVG sectors image or rely on CSS rotation
               Here we keep inner as placeholder — numbers will be in the spin result -->
          <div class="center"></div>
        </div>
      </div>
    </div>

    <button id="spinBtn">GIRAR ROLET A</button>
    <small>Promoção válida até 10/12 — apenas novos orçamentos</small>
  </div>

<script>
/*
 Frontend logic:
 - Ao clicar, calculamos uma rotação aleatória (multiples spins) e determinamos a "fatia" pelo ângulo final.
 - Enviamos resultado ao backend via fetch POST /spin com JSON {result, angle, timestamp}
 - Backend envia WhatsApp pra você (via Twilio)
 - Ajuste as fatias em `segments` conforme seu layout.
*/

const segments = [
  {label:'50% OFF', type:'percent'},
  {label:'30% OFF', type:'percent'},
  {label:'R$ 200', type:'money'},
  {label:'R$ 300', type:'money'},
  {label:'20% OFF', type:'percent'},
  {label:'50% OFF', type:'percent'}
];
// number of segments:
const segCount = segments.length;

const wheelInner = document.getElementById('wheelInner');
const spinBtn = document.getElementById('spinBtn');

function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min }

spinBtn.addEventListener('click', async () => {
  spinBtn.disabled = true;
  spinBtn.innerText = 'GIRANDO...';

  // choose random final segment
  const chosenIndex = randomInt(0, segCount-1);
  // compute final angle so pointer hits chosen segment:
  // each slice size in degrees:
  const slice = 360 / segCount;
  // pick random offset inside slice for realism
  const offset = Math.random() * (slice - 6) - (slice/2 - 3);
  // we want many full rotations + final angle:
  const full = 360 * randomInt(4,7);
  const finalAngle = full + (360 - (chosenIndex * slice) - slice/2) + offset;

  // animate:
  wheelInner.style.transition = 'transform 4s cubic-bezier(.2,.9,.2,1)';
  wheelInner.style.transform = `rotate(${finalAngle}deg)`;

  // wait animation end:
  await new Promise(res => setTimeout(res, 4200));

  const result = segments[chosenIndex].label;
  // show quick alert (you can show modal)
  alert('Resultado: ' + result);

  // send to backend to trigger WhatsApp notification
  try {
    await fetch('/spin', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        result,
        chosenIndex,
        timestamp: new Date().toISOString(),
        source: 'roleta_link_instagram'
      })
    });
    // success UI
    spinBtn.innerText = 'GIRAR NOVAMENTE';
    spinBtn.disabled = false;
  } catch(err){
    console.error(err);
    alert('Erro ao notificar. Contate o administrador.');
    spinBtn.innerText = 'GIRAR NOVAMENTE';
    spinBtn.disabled = false;
  }
});
</script>
</body>
</html>
